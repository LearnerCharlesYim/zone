<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{component::statics}"></head>

<body>
<div th:replace="~{component::header}"></div>
<div class="aw-container-wrap">
    <div class="container">
        <div class="row">
            <div class="aw-content-wrap clearfix">
                <div class="col-sm-12 col-md-9 aw-main-content">
                    <div id="main-content" class="aw-mod aw-question-detail aw-item">

                    </div>

                    <div class="aw-mod aw-question-comment">
                        <div id="commentCount" class="mod-head">

                        </div>
                        <div id="commentList" class="mod-body aw-feed-list">

                        </div>

                    </div>

                    <!-- 回复编辑器 -->
                    <div class="aw-mod aw-replay-box question">
                        <a name="answer_form"></a>
                        <p align="center">要回复问题请先<a href="https://elasticsearch.cn/account/login/">登录</a>或<a href="https://elasticsearch.cn/account/register/">注册</a></p>
                    </div>
                    <!-- end 回复编辑器 -->
                </div>


                <!-- 侧边栏 -->
                <div class="col-sm-12 col-md-3 aw-side-bar hidden-xs hidden-sm">
                    <style>
                        .aw-side-bar .right-ad {margin-bottom:10px}
                        .aw-side-bar .right-ad a{margin-bottom:10px;display: block;}
                    </style>
                    <div class="aw-mod interest-user">
                        <div class="mod-head"><h3>活动推荐</h3></div>
                        <style>
                            .activity-recommend-item {
                                display: block;
                                text-decoration: none;
                                padding-top: 8px;
                                padding-bottom: 8px;
                            }

                            .activity-recommend-item:not(:last-child) {
                                border-bottom: 1px dashed #eee;
                            }

                            .activity-date-wrapper {
                                width: 32px;
                                padding: 4px;
                                height: 34px;
                                background: #C8E9DE !important;
                                border-radius: 2px;
                                line-height: 95% !important;
                            }

                            .activity-detail{
                                font-size: 12px;
                                margin-left:40px;
                            }

                            .activity-detail-title{
                                font-size: 14px;
                            }

                            .activity-recommend a {
                                color: #009a61;
                                text-decoration: none;
                            }

                            .activity-date-up {
                                font-size: 12px;
                                transform: scale(0.833);
                            }

                            .activity-date-down {
                                font-size: 16px;
                            }

                            .activity-date {
                                color: #017E66;
                                margin-right: 10px;
                                margin-top: 3px;
                                text-align: center;
                            }
                            .activity-detail-base {
                                font-size: 12px;
                                color: #999;
                            }
                            .dot {
                                color: #999;
                                font-weight: normal;
                                padding: 0 5px;
                            }
                            .activity-state {
                                font-size: 12px;
                                color: #f5b933;
                            }
                            .activity-state-on{
                                font-size: 12px;
                                color: #f52f1e;
                            }

                        </style>
                        <div class="mod-body">
                            <a class="activity-recommend-item" href="#">
                                <div class="activity-date pull-left">
                                    <div class="activity-date-wrapper">
                                        <div class="activity-date-up">Nov</div>
                                        <div class="activity-date-down">13</div>
                                    </div>
                                </div>
                                <div class="activity-detail">
                                    <div class="activity-detail-title">Elastic 2021 线下技术沙龙-武汉站</div>
                                    <span class="activity-detail-base">武汉</span><span class="dot">·</span>11-13&nbsp;周六<span class="dot">·</span><span class="activity-state">报名中</span>
                                </div>
                            </a>
                        </div>
                    </div>
                    <div class="aw-mod aw-text-align-justify">
                        <div class="mod-head">
                            <a href="https://elasticsearch.cn/topic/channel-hot" class="pull-right">更多 &gt;</a>
                            <h3>热门话题</h3>
                        </div>
                        <div class="mod-body">
                            <dl>
                                <dt class="pull-left aw-border-radius-5">
                                    <a href="https://elasticsearch.cn/topic/Elastic日报"><img alt="" src="https://elasticsearch.cn/uploads/topic/20170801/c323ba600f2ebc015b15c9d329e29369_50_50.jpeg" /></a>
                                </dt>
                                <dd class="pull-left">
                                    <p class="clearfix">
										<span class="topic-tag">
											<a href="https://elasticsearch.cn/topic/Elastic日报" class="text" data-id="1352">Elastic日报</a>
										</span>
                                    </p>
                                    <p><b>1213</b> 个问题, <b>149</b> 人关注</p>
                                </dd>
                            </dl>
                            <dl>
                                <dt class="pull-left aw-border-radius-5">
                                    <a href="https://elasticsearch.cn/topic/Elastic日报"><img alt="" src="https://elasticsearch.cn/uploads/topic/20170801/c323ba600f2ebc015b15c9d329e29369_50_50.jpeg" /></a>
                                </dt>
                                <dd class="pull-left">
                                    <p class="clearfix">
										<span class="topic-tag">
											<a href="https://elasticsearch.cn/topic/Elastic日报" class="text" data-id="1352">Elastic日报</a>
										</span>
                                    </p>
                                    <p><b>1213</b> 个问题, <b>149</b> 人关注</p>
                                </dd>
                            </dl>
                            <dl>
                                <dt class="pull-left aw-border-radius-5">
                                    <a href="https://elasticsearch.cn/topic/Elastic日报"><img alt="" src="https://elasticsearch.cn/uploads/topic/20170801/c323ba600f2ebc015b15c9d329e29369_50_50.jpeg" /></a>
                                </dt>
                                <dd class="pull-left">
                                    <p class="clearfix">
										<span class="topic-tag">
											<a href="https://elasticsearch.cn/topic/Elastic日报" class="text" data-id="1352">Elastic日报</a>
										</span>
                                    </p>
                                    <p><b>1213</b> 个问题, <b>149</b> 人关注</p>
                                </dd>
                            </dl>
                            <dl>
                                <dt class="pull-left aw-border-radius-5">
                                    <a href="https://elasticsearch.cn/topic/Elastic日报"><img alt="" src="https://elasticsearch.cn/uploads/topic/20170801/c323ba600f2ebc015b15c9d329e29369_50_50.jpeg" /></a>
                                </dt>
                                <dd class="pull-left">
                                    <p class="clearfix">
										<span class="topic-tag">
											<a href="https://elasticsearch.cn/topic/Elastic日报" class="text" data-id="1352">Elastic日报</a>
										</span>
                                    </p>
                                    <p><b>1213</b> 个问题, <b>149</b> 人关注</p>
                                </dd>
                            </dl>
                        </div>
                    </div>
                    常用链接
                    <br/>
                    <a href="https://www.elastic.co/" target="_blank">
                        <span style="font-size: 12px;clear: both;"><i class="glyphicon glyphicon-book"> </i>Elastic 官方网站</span>
                    </a>
                    <br/>
                    <a href="http://v.qq.com/vplus/ccbfe87ac7828b23a25e9827b38c171e" target="_blank">
                        <span style="font-size: 12px;clear: both;"><i class="glyphicon glyphicon-book"> </i>Elastic 社区分享回放</span>
                    </a>
                    <br/>
                </div>
                <!-- end 侧边栏 -->
            </div>
        </div>
    </div>
</div>

<div th:replace="~{component::footer}"></div>
<script th:inline="javascript">
    $(function () {
        const param = location.href.split("/")[location.href.split("/").length - 1];
        $.get("/post/"+param,{},function (res) {
            if(res.state === 200){
                let html = `
                      <div class="mod-head">
                            <h1>${res.data.title}</h1>
                            <em class="text-color-999">
                                <a class="aw-question-tags" href="#">${res.data.board.name}</a>
                                | 作者
                                <a class="aw-user-name" href="#" data-id="10161">${res.data.author.username}</a>
                                | 发布于${res.data.createdTime}| 阅读数：<span>${res.data.viewCount}</span>
                            </em>
                            <hr>
                        </div>
                        <div class="mod-body">
                            <div class="content markitup-box">
                                ${res.data.content}
                            </div>
                        </div>
                        <div class="mod-footer">
                            <div class="meta">
                                <span class="text-color-999">${res.data.createdTime}</span>
                                <a data-id="11725" data-type="question" class="aw-add-comment text-color-999  active" data-comment-count="0"><i class="glyphicon glyphicon-comment"></i>添加评论</a>

                                <div class="pull-right more-operate">

                                </div>

                            </div>

                        </div>

                `;
                $("#main-content").html(html);
                $("#commentCount").html(
                    `<ul class="nav nav-tabs aw-nav-tabs active">
                        <h2 class="hidden-xs">${res.data.commentCount} 个回复</h2>
                    </ul>
                    `
                )
            }
        });
        $.get("/comment/list/"+param,{},function (res){
            if(res.state === 200){
                let html = ``;
                for(let i=0;i<res.data.length;i++){
                    html +=  `<div class="aw-item">
                                <div class="mod-head">
                                    <a class="anchor" name="answer_16761"></a>
                                    <!-- 用户头像 -->
                                    <a class="aw-user-img aw-border-radius-5" href="#"><img src="/css/default/img/avatar-mid-img.png" alt="" data-bd-imgshare-binded="1"></a>
                                    <div class="title">
                                        <p>
                                            <a class="aw-user-name" href="#" data-id="12694">${res.data[i].author.username}</a>
                                        </p>
                                    </div>
                                </div>
                                <div class="mod-body clearfix">
                                    <!-- 评论内容 -->
                                    <div class="markitup-box">
                                        ${res.data[i].content}
                                    </div>

                                    <!-- end 评论内容 -->
                                </div>
                                <div class="mod-footer">
                                    <!-- 社交操作 -->
                                    <div class="meta clearfix">
                                            <span class="text-color-999 pull-right reply" flag="close" data-id="${res.data[i].uuid}" style="cursor: pointer">回复</span>
                                            <span class="text-color-999 pull-right" style="margin-right: 10px;">${res.data[i].createdTime}</span>

                                            <!-- 投票栏 -->
                                            <span class="operate">
                                                <a class="agree  disabled"><i data-placement="right" title="" data-toggle="tooltip" class="glyphicon glyphicon-thumbs-up" data-original-title="赞同回复"></i> <b class="count">0</b></a>
                                            </span>
                                            <!-- end 投票栏 -->
                                            <span class="operate add-comment">
                                                <a class="aw-add-comment"  data-type="answer" data-comment-count="0" href="javascript:;"><i class="glyphicon glyphicon-comment"></i> ${res.data[i].children.length}</a>
                                            </span>
                                     </div>
                                    `;
                        if(res.data[i].children.length === 0){
                            html += ` <div class="aw-comment-box" style="display: none">
                                            <div class="aw-comment-list">
                                                <div align="center" class="aw-padding10">暂无评论</div>
                                            </div>
                                       </div>`;
                    }else{
                            html += `  <div class="aw-comment-box">
                                            <div class="aw-comment-list">
                                                <ul>

                                            `;
                        for (let j=0;j<res.data[i].children.length;j++){
                            html += `
                                                    <li>
                                                        <a class="aw-user-name" href="#">
                                                            <img src="/css/default/img/avatar-mid-img.png" alt="" data-bd-imgshare-binded="1">
                                                        </a>
                                                        <div class="">
                                                            <a href="#" class="aw-user-name author">${res.data[i].children[j].author.username}</a>
                                                                 •
                                                            <span>${res.data[i].children[j].createdTime}</span>
                                                            <p class="clearfix">
                                                                @${res.data[i].children[j].replyToAuthor.username}&nbsp;
                                                                ${res.data[i].children[j].content}
                                                                <span class="text-color-999 pull-right replyTo" data-id="${res.data[i].uuid}" data-name="${res.data[i].children[j].author.username}" flag="close" style="cursor: pointer;float: right">回复</span>

                                                            </p>
                                                        </div>
                                                    </li>
                                       `
                        }
                        html += `                </ul>
                                             </div>
                                          </div>

                                    `
                    }
                    html += `</div></div>`
                }
                $("#commentList").html(html);

            }
        });

        const container = $(".container");
        //回复box
        const replyBox = ` <div class="replyBox" style="padding-bottom: 40px;">
                              <div class="form-group">
                                  <textarea class="form-control" rows="3" placeholder="发表神评妙论" style="margin: 0 16.5px 0 0; width: 728px; height: 76px;"></textarea>
                              </div><button type="button" class="btn btn-info" style="width: 80px;">发表</button>
                           </div>`

        const replyBoxTo = ` <div class="replyBox" style="padding-top: 20px;">
                              <div class="form-group">
                                  <textarea class="form-control" rows="3" placeholder="" style="margin: 0 16.5px 0 0; width: 660px; height: 76px;"></textarea>
                              </div><button type="button" class="btn btn-info" style="width: 80px;">发表</button>
                           </div>`

        container.on("click",'.add-comment',function () {
            let self = $(this);
            self.parent().parent().find(".aw-comment-box").toggle("slow");
        })

        //根评论回复点击事件
        container.on("click",'.reply',function () {
            let self = $(this);
            if(self.attr("flag") === 'close'){
                $(".reply").attr("flag","close");
                $(".replyTo").attr("flag","close");
                $(".replyBox").remove();
                self.parent().parent().find(".aw-comment-box").show();
                self.parent().parent().find(".aw-comment-list").prepend(replyBox);
                self.parent().parent().find(".replyBox button").attr("data-id",self.attr("data-id"));
                self.attr("flag","open");
            }else{
                $(".replyBox").remove();
                self.attr("flag","close");
            }
        })
        //子评论回复点击事件
        container.on("click",'.replyTo',function () {
            let self = $(this);
            if(self.attr("flag") === "close"){
                $(".reply").attr("flag","close");
                $(".replyTo").attr("flag","close");
                $(".replyBox").remove();
                self.parent().parent().after(replyBoxTo);
                self.parent().parent().parent().find(".replyBox button").attr("data-id",self.attr("data-id")).attr("data-name",self.attr("data-name"));
                self.parent().parent().parent().find(".replyBox textarea").prop("placeholder","回复"+self.attr("data-name"));
                self.attr("flag","open");
            }else{
                $(".replyBox").remove();
                self.attr("flag","close");
            }

        })

    })
</script>
</body>
</html>
